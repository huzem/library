<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dijital K√ºt√ºphane - HUZEM</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>

<style>
:root{
  --bordo:#7a0c18;
  --bordo2:#9c1a2b;
  --bg:#f4f7f6; /* Arka planƒ± biraz daha yumu≈üattƒ±k */
  --sidebar-width: 380px;
}

*{
  margin:0; padding:0; box-sizing:border-box; font-family:"Segoe UI",system-ui,sans-serif;
}

body{
  background:var(--bg);
  -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; 
}

/* Gƒ∞Rƒ∞≈û PANELƒ∞ (Deƒüi≈ümedi) */
#login-overlay { position: fixed; inset: 0; background: var(--bordo); display: flex; justify-content: center; align-items: center; z-index: 10000; padding: 20px; }
.login-box { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; max-width: 400px; width: 100%; }
.login-box img { height: 80px; margin-bottom: 20px; }
.login-box h2 { color: var(--bordo); margin-bottom: 20px; font-size: 20px; }
.login-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #ddd; border-radius: 8px; outline: none; font-size: 16px; text-align: center; }
.login-box input:focus { border-color: var(--bordo); }
.login-box button { background: var(--bordo); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
.login-box button:hover { background: var(--bordo2); }
#main-content { display: none; }

/* HEADER */
header{ background:linear-gradient(90deg,var(--bordo),var(--bordo2)); color:white; padding:16px 20px; text-align:center; letter-spacing:.5px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
.header-top{ display:flex; align-items:center; justify-content:center; gap:16px; flex-wrap:wrap; }
.header-top img{ height:60px; }
.header-title{ font-size:24px; font-weight:bold; }
.header-subtitle{ font-size:16px; margin-top:4px; font-weight:500; opacity: 0.9; }

/* === PREMIUM AKORDEON D√úZENƒ∞ === */
.library { display: flex; flex-direction: column; gap: 20px; padding: 40px; max-width: 1200px; margin: 0 auto; }

.category-box {
  background: white; 
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  overflow: hidden; /* K√∂≈üelerin ta≈ümasƒ±nƒ± engeller */
  transition: box-shadow 0.3s ease;
}

.category-box:hover { box-shadow: 0 6px 16px rgba(0,0,0,0.1); }

/* Akordeon Ba≈ülƒ±ƒüƒ± */
.category-header {
  padding: 20px 25px; 
  cursor: pointer; 
  display: flex; justify-content: space-between; align-items: center;
  background: white;
  transition: background 0.3s ease;
  user-select: none;
}

.category-header:hover { background: #fafafa; }

/* Ba≈ülƒ±k Sol Taraf (ƒ∞kon ve Yazƒ±) */
.header-left { display: flex; align-items: center; gap: 12px; }
.header-left .icon-book { font-size: 20px; color: var(--bordo); }
.header-title-text { font-size: 18px; font-weight: 700; color: #2c3e50; }

/* Ba≈ülƒ±k Saƒü Taraf (Rozet ve Ok) */
.header-right { display: flex; align-items: center; gap: 15px; }

/* Kitap Sayƒ±sƒ± Rozeti */
.book-count-badge {
  background: #f0f2f5; color: #555;
  font-size: 13px; font-weight: 600;
  padding: 4px 12px; border-radius: 20px;
}

/* D√∂nen Ok ƒ∞konu (SVG) */
.chevron-icon {
  width: 24px; height: 24px;
  fill: none; stroke: var(--bordo); stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round;
  transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
}

.category-box.active .chevron-icon {
  transform: rotate(180deg);
}
.category-box.active .category-header {
  border-bottom: 1px solid #eee;
}

/* CSS Grid ile P√ºr√ºzs√ºz Dikey A√ßƒ±lma Animasyonu */
.category-content-wrapper {
  display: grid;
  grid-template-rows: 0fr;
  transition: grid-template-rows 0.4s cubic-bezier(0.25, 1, 0.5, 1);
}

.category-box.active .category-content-wrapper {
  grid-template-rows: 1fr;
}

.category-content-inner {
  overflow: hidden;
}

/* Yatay Kaydƒ±rmalƒ± Raf (Carousel) */
.books-shelf {
  display: flex; gap: 20px; padding: 25px;
  overflow-x: auto;
  background: #fdfdfd; /* √áok hafif bir derinlik */
  scroll-behavior: smooth;
}

/* √ñzel Kaydƒ±rma √áubuƒüu (Yatay) */
.books-shelf::-webkit-scrollbar { height: 8px; }
.books-shelf::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; border: 2px solid #fdfdfd; }
.books-shelf::-webkit-scrollbar-thumb:hover { background: var(--bordo); }
.books-shelf::-webkit-scrollbar-track { background: transparent; }

/* Kƒ∞TAP KARTLARI */
.book {
  background: white; border-radius: 10px; padding: 12px; cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  width: 170px; flex-shrink: 0; white-space: normal;
  border: 1px solid #f0f0f0;
}
.book:hover { transform: translateY(-6px); box-shadow: 0 12px 20px rgba(122, 12, 24, 0.15); border-color: transparent; }
.book img { width: 100%; height: 230px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.book-title { margin-top: 12px; font-weight: 600; font-size: 14px; text-align: center; line-height: 1.3; color: #222; }
.book-author { font-size: 12px; color: #777; text-align: center; margin-top: 6px;}

/* MODAL KISMI (Deƒüi≈ümedi, sadece aray√ºz temizlendi) */
.modal{ position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; flex-direction:column; z-index: 9999; }
.modal-header{ background:var(--bordo); color:white; padding:12px 20px; font-size:16px; display:flex; justify-content:space-between; align-items:center; box-shadow: 0 2px 10px rgba(0,0,0,0.3); flex-shrink: 0; }
.modal-content { display: flex; flex: 1; min-height: 0; overflow: hidden; }
@media (max-width: 900px) { .modal-content { flex-direction: column; overflow-y: auto; } .comments-sidebar { width: 100% !important; height: 500px; border-left: none; border-top: 2px solid var(--bordo); } .pdf-viewer-section { height: auto; min-height: 60vh; } }
.pdf-viewer-section { flex: 1; display: flex; flex-direction: column; min-width: 0; background: #525659; position: relative; }
.comments-sidebar { width: var(--sidebar-width); background: white; border-left: 2px solid var(--bordo); display: flex; flex-direction: column; overflow-y: auto; flex-shrink: 0; }
.close-btn{ background:white; border:none; padding:6px 12px; font-weight:bold; cursor:pointer; border-radius:6px; color: var(--bordo); }
.pdf-controls { background: #333; color: white; padding: 10px; display: flex; justify-content: center; align-items: center; gap: 20px; }
.control-btn { background: #666; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
.control-btn:hover { background: var(--bordo); }
.control-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.viewer-container { flex: 1; overflow-y: auto; display: flex; justify-content: center; align-items: flex-start; padding: 20px; position: relative; }
.flipbook-spread { display: flex; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
.flipbook-spread canvas { border-right: 1px solid #ddd; }
.flipbook-spread canvas:last-child { border-right: none; }
.single-page-wrapper { box-shadow: 0 4px 15px rgba(0,0,0,0.5); position: relative; }
.pdf-page-canvas { display: block; pointer-events: none; background: white; }
.link-layer { position: absolute; inset:0; }
.pdf-link { position: absolute; cursor: pointer; background: rgba(255, 255, 0, 0); transition: background 0.2s; }
.pdf-link:hover { background: rgba(255, 255, 0, 0.2); border: 1px solid rgba(0,0,0,0.2); }
.watermark-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 1000; overflow: hidden; opacity: 0.15; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='150px' width='150px'><text transform='translate(20, 100) rotate(-45)' fill='black' font-size='20' font-family='Arial'>HUZEM¬©</text></svg>"); }
.loading { color: white; font-size: 18px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold; }
img, canvas, .viewer-container { -webkit-user-drag: none; user-drag: none; }
</style>
</head>
<body oncontextmenu="return false">

  <!--
<div id="login-overlay">
  <div class="login-box">
   <img src="https://hitit.edu.tr/images/HititLogoYeni.svg" alt="Hitit Logo" style="background-color: white; padding: 5px;">
   <h2>Dijital K√ºt√ºphane Eri≈üimi</h2>
   <input type="password" id="passwordInput" placeholder="≈ûifreyi Giriniz" onkeydown="if(event.key==='Enter') checkPassword()">
   <button onclick="checkPassword()">Giri≈ü Yap</button>
   <p id="loginError" style="color: #7a0c18; margin-top: 10px; font-size: 14px; display: none; font-weight: bold;">‚ö†Ô∏è Hatalƒ± ≈üifre!</p>
  </div>
</div>
-->

<div id="main-content" style="display:block;">
    <header>
      <div class="header-top">
        <img src="https://hitit.edu.tr/images/HititLogoYeni.svg" alt="Hitit √úniversitesi Logo" style="background-color:white; padding:6px; border-radius:8px;">
        <div>
          <div class="header-title">Uzaktan Eƒüitim Uygulama ve Ara≈ütƒ±rma Merkezi (HUZEM)</div>
          <div class="header-subtitle">Kaynak K√ºt√ºphanesi</div>
        </div>
      </div>
    </header>

    <div class="library" id="library"></div>

    <div class="modal" id="modal">
      <div class="modal-header">
        <span id="modalTitle">Kitap Okuyucu</span>
        <button class="close-btn" onclick="closeViewer()">Kapat</button>
      </div>
      <div class="modal-content">
        <div class="pdf-viewer-section">
          <div class="pdf-controls">
              <button class="control-btn" id="prevBtn" onclick="changePage(-1)">‚ùÆ √ñnceki</button>
              <span>Sayfa: <span id="page_num"></span> / <span id="page_count"></span></span>
              <button class="control-btn" id="nextBtn" onclick="changePage(1)">Sonraki ‚ùØ</button>
          </div>
          <div class="viewer-container" id="pdfContainer">
            <div id="loadingText" class="loading" style="display: none;">Y√ºkleniyor...</div>
            <div class="watermark-overlay"></div>
            <div id="pdfViewerContent"></div>
          </div>
        </div>
        <div class="comments-sidebar" id="commentsSection">
          <h3 style="color: var(--bordo); margin-bottom: 12px; padding: 15px 15px 0 15px; font-size: 16px;">üí¨ Yorum</h3>
          <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSey6PHs6VUzsog_8-mWaszOlSGWyb7bi64Szra7p0VodsJm7A/viewform?embedded=true" width="100%" height="900" frameborder="0" marginheight="0" marginwidth="0" style="border: none; flex-shrink: 0;">Y√ºkleniyor‚Ä¶</iframe>
        </div>
      </div>
    </div>
</div>

<script>

// ≈ûifre Kontrol√º GE√áƒ∞Cƒ∞ KAPATTIM
/*
function checkPassword() {
  const pass = document.getElementById("passwordInput").value;
  const errorMsg = document.getElementById("loginError");
  const loginOverlay = document.getElementById("login-overlay");
  const mainContent = document.getElementById("main-content");
  const hiddenPassword = "aGl0aXQyMDI2";

  if (btoa(pass) === hiddenPassword) {
    loginOverlay.style.display = "none";
    mainContent.style.display = "block";
  } else {
    errorMsg.style.display = "block";
    document.getElementById("passwordInput").value = "";
    document.getElementById("passwordInput").focus();
  }
}
*/

// Kƒ∞TAP VERƒ∞LERƒ∞
const groupedBooks = [
  {
    title: "Yapay Zek√¢ Serisi",
    books: [
      { title:"Mod√ºl 1: Yapay Zek√¢ ve Eƒüitim", author:"HUZEM", cover:"kapaklar/ai1.png", file:"kitaplƒ±k/ai1.pdf" },
      { title:"Mod√ºl 2: Y√ºksek√∂ƒüretimde Yapay Zek√¢ Destekli √ñƒüretim", author:"HUZEM", cover:"kapaklar/ai2.png", file:"kitaplƒ±k/ai2.pdf" },
      { title:"Mod√ºl 3: Y√ºksek√∂ƒüretimde Yapay Zek√¢ Uygulamalarƒ±", author:"HUZEM", cover:"kapaklar/ai3.png", file:"kitaplƒ±k/ai3.pdf" },
      { title:"Mod√ºl 4: Yapay Zek√¢ Ara√ßlarƒ± Entegrasyonu", author:"HUZEM", cover:"kapaklar/ai4.png", file:"kitaplƒ±k/ai4.pdf" }
    ]
  },
  {
    title: "Yeterlilik Temelli Deƒüerlendirme Serisi",
    books: [
      { title:"Mod√ºl 1: √ñl√ßme ve Deƒüerlendirmede Temel Kavramlar", author:"HUZEM", cover:"kapaklar/ytd1.png", file:"kitaplƒ±k/ytd1.pdf" },
      { title:"Mod√ºl 2: Yeterlilik ve Performans Temelli Giri≈ü", author:"HUZEM", cover:"kapaklar/ytd2.png", file:"kitaplƒ±k/ytd2.pdf" },
      { title:"Mod√ºl 3: √ñl√ßme-Deƒüerlendirme Y√∂ntemleri", author:"HUZEM", cover:"kapaklar/ytd3.png", file:"kitaplƒ±k/ytd3.pdf" },
      { title:"Mod√ºl 4: Etkili ve Nitelikli Geribildirim Rehberi", author:"HUZEM", cover:"kapaklar/ytd4.png", file:"kitaplƒ±k/ytd4.pdf" },
      { title:"Mod√ºl 5: Birimlerden Gelen Uygulama √ñrnekleri", author:"HUZEM", cover:"kapaklar/ytd5.png", file:"kitaplƒ±k/ytd5.pdf" }
    ]
  }
];

const library = document.getElementById("library");
const modal = document.getElementById("modal");
const titleEl = document.getElementById("modalTitle");
const loadingText = document.getElementById("loadingText");
const pdfViewerContent = document.getElementById("pdfViewerContent");
const pageNumSpan = document.getElementById("page_num");
const pageCountSpan = document.getElementById("page_count");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");

// D√∂ner ok ikonu SVG
const chevronSVG = `<svg class="chevron-icon" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"></polyline></svg>`;

// PREMIUM AKORDEON OLU≈ûTURMA
groupedBooks.forEach((group, index) => {
  const groupEl = document.createElement("div");
  groupEl.className = "category-box";
  
  // Sadece ilk seriyi ba≈ülangƒ±√ßta a√ßƒ±k yapƒ±yoruz
  if(index === 0) groupEl.classList.add("active");

  // Ba≈ülƒ±k Kƒ±smƒ±
  const header = document.createElement("div");
  header.className = "category-header";
  header.innerHTML = `
    <div class="header-left">
      <span class="icon-book">üìö</span>
      <span class="header-title-text">${group.title}</span>
    </div>
    <div class="header-right">
      <span class="book-count-badge">${group.books.length} Kitap</span>
      ${chevronSVG}
    </div>
  `;
  
  // ƒ∞√ßerik Sarƒ±cƒ± (Animasyon i√ßin Grid Hack)
  const contentWrapper = document.createElement("div");
  contentWrapper.className = "category-content-wrapper";
  
  // Asƒ±l ƒ∞√ßerik (Raf)
  const contentInner = document.createElement("div");
  contentInner.className = "category-content-inner";

  const shelf = document.createElement("div");
  shelf.className = "books-shelf";
  
  group.books.forEach(b => {
    const bookEl = document.createElement("div");
    bookEl.className = "book";
    const coverSrc = b.cover ? b.cover : 'https://via.placeholder.com/160x220?text=' + encodeURIComponent(b.title.substring(0,10)+'...');
    bookEl.innerHTML = `
      <img src="${coverSrc}" onerror="this.src='https://via.placeholder.com/160x220?text=Kapak+Yok'">
      <div class="book-title">${b.title}</div>
      <div class="book-author">${b.author}</div>
    `;
    bookEl.onclick = () => loadPDF(b);
    shelf.appendChild(bookEl);
  });
  
  contentInner.appendChild(shelf);
  contentWrapper.appendChild(contentInner);

  // Tƒ±klama Olayƒ± (Yumu≈üak Kapanƒ±p A√ßƒ±lma)
  header.onclick = () => {
    const isOpen = groupEl.classList.contains("active");
    
    // Diƒüerlerini kapat
    document.querySelectorAll('.category-box').forEach(box => {
      box.classList.remove('active');
    });
    
    // Tƒ±klanan kapalƒ±ysa a√ß
    if (!isOpen) {
      groupEl.classList.add("active");
    }
  };
  
  groupEl.appendChild(header);
  groupEl.appendChild(contentWrapper);
  library.appendChild(groupEl);
});

// --- PDF FONKSƒ∞YONLARI (Aynƒ± Kaldƒ±) ---
let pdfDoc = null, pageNum = 1, pageRendering = false, currentViewMode = 'single';
const scale = 1.5;

async function loadPDF(book) {
    modal.style.display = "flex"; titleEl.textContent = book.title; loadingText.style.display = "block"; pdfViewerContent.innerHTML = "";
    currentViewMode = book.mode === 'flipbook' ? 'flipbook' : 'single'; pageNum = 1;
    try {
        const loadingTask = pdfjsLib.getDocument(book.file);
        pdfDoc = await loadingTask.promise; pageCountSpan.textContent = pdfDoc.numPages; loadingText.style.display = "none";
        renderCurrentView();
    } catch (error) { console.error("PDF Hatasƒ±:", error); loadingText.textContent = "PDF y√ºklenemedi. Dosya yolu hatalƒ± olabilir."; }
}

function renderCurrentView() {
    pageRendering = true; pdfViewerContent.innerHTML = ""; updateControls();
    if (currentViewMode === 'single') renderSinglePage(pageNum);
    else if (currentViewMode === 'flipbook') renderFlipbookSpread(pageNum);
}

function changePage(offset) {
    if (pageRendering) return;
    let newPageNum = pageNum;
    if (currentViewMode === 'single') newPageNum += offset;
    else newPageNum += offset * 2;
    if (newPageNum < 1 || newPageNum > pdfDoc.numPages) return;
    pageNum = newPageNum; renderCurrentView();
}

function updateControls() {
    pageNumSpan.textContent = currentViewMode === 'flipbook' && pageNum < pdfDoc.numPages ? `${pageNum}-${pageNum+1}` : pageNum;
    prevBtn.disabled = pageNum <= 1;
    if (currentViewMode === 'single') nextBtn.disabled = pageNum >= pdfDoc.numPages;
    else nextBtn.disabled = pageNum >= pdfDoc.numPages || pageNum + 1 >= pdfDoc.numPages;
}

async function renderSinglePage(num) {
    try {
        const page = await pdfDoc.getPage(num); const viewport = page.getViewport({ scale: scale });
        const wrapper = document.createElement("div"); wrapper.className = "single-page-wrapper"; wrapper.style.width = viewport.width + "px"; wrapper.style.height = viewport.height + "px";
        const canvas = document.createElement("canvas"); const context = canvas.getContext("2d"); canvas.height = viewport.height; canvas.width = viewport.width; canvas.className = "pdf-page-canvas";
        await addLinkLayer(page, viewport, wrapper);
        wrapper.appendChild(canvas); pdfViewerContent.appendChild(wrapper);
        await page.render({ canvasContext: context, viewport: viewport }).promise; pageRendering = false;
    } catch(e) { console.error("Render hatasƒ±:", e); pageRendering = false; }
}

async function renderFlipbookSpread(num) {
    const spreadContainer = document.createElement("div"); spreadContainer.className = "flipbook-spread"; pdfViewerContent.appendChild(spreadContainer);
    if (num <= pdfDoc.numPages) { await renderPageToContainer(num, spreadContainer); }
    if (num + 1 <= pdfDoc.numPages) { await renderPageToContainer(num + 1, spreadContainer); }
    pageRendering = false;
}

async function renderPageToContainer(num, container) {
    try {
        const page = await pdfDoc.getPage(num); const viewport = page.getViewport({ scale: scale * 0.9 });
        const wrapper = document.createElement("div"); wrapper.className = "single-page-wrapper"; wrapper.style.width = viewport.width + "px"; wrapper.style.height = viewport.height + "px";
        const canvas = document.createElement("canvas"); const context = canvas.getContext("2d"); canvas.height = viewport.height; canvas.width = viewport.width; canvas.className = "pdf-page-canvas";
        await addLinkLayer(page, viewport, wrapper);
        wrapper.appendChild(canvas); container.appendChild(wrapper);
        await page.render({ canvasContext: context, viewport: viewport }).promise;
    } catch(e) { console.error("Spread render hatasƒ±:", e); }
}

async function addLinkLayer(page, viewport, wrapper) {
    const linkLayer = document.createElement("div"); linkLayer.className = "link-layer";
    const annotations = await page.getAnnotations();
    annotations.forEach(annotation => {
        if (annotation.subtype === 'Link' && annotation.url) {
            const rect = viewport.convertToViewportRectangle(annotation.rect); const x = Math.min(rect[0], rect[2]); const y = Math.min(rect[1], rect[3]); const width = Math.abs(rect[2] - rect[0]); const height = Math.abs(rect[3] - rect[1]);
            const link = document.createElement("a"); link.href = annotation.url; link.target = "_blank"; link.className = "pdf-link"; link.style.left = x + "px"; link.style.top = y + "px"; link.style.width = width + "px"; link.style.height = height + "px";
            linkLayer.appendChild(link);
        }
    }); wrapper.appendChild(linkLayer);
}

function closeViewer(){ modal.style.display="none"; pdfDoc = null; pdfViewerContent.innerHTML = ""; }
document.addEventListener('contextmenu', event => event.preventDefault());
document.addEventListener("keydown", function(e){ if (e.ctrlKey && (e.key === 'c' || e.key === 's' || e.key === 'p' || e.key === 'u' || e.key === 'a')) { e.preventDefault(); return false; } });
</script>
</body>
</html>
